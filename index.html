<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pick Logger — Robust Start</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:0;display:flex;flex-direction:column;min-height:100vh}
  #top{background:#0d47a1;color:#fff;padding:10px}
  #controls{padding:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  #reader{flex:1;display:flex;align-items:center;justify-content:center;background:#000;color:#fff;min-height:260px}
  #list{max-height:180px;overflow:auto;padding:8px;background:#f9f9f9}
  .row{display:flex;justify-content:space-between;padding:6px;border-bottom:1px solid #eee;align-items:center}
  .thumb{height:36px;margin-left:8px;border:1px solid #ccc}
  button,input,select{padding:8px;margin:4px}
  #debug{font-size:0.86rem;padding:8px;color:#111;background:#fafafa;border-top:1px solid #ddd}
</style>
</head>
<body>
  <div id="top"><strong>Pick Logger</strong> — Start control & debug</div>

  <div id="controls">
    <label>Technician: <input id="tech" placeholder="Your name"></label>
    <label>Mode:
      <select id="mode"><option value="scan">Scan</option><option value="manual">Manual+Photo</option></select>
    </label>
    <button id="loadLib">Load scanner lib</button>
    <button id="listCams">List cameras</button>
    <select id="camSelect" style="min-width:160px"></select>
    <button id="startCam">Start camera</button>
    <button id="stopCam">Stop camera</button>
    <button id="clearAll">Clear</button>
    <button id="shareBtn">Share</button>
  </div>

  <div id="reader">Camera preview will appear here (allow camera)</div>

  <div style="padding:8px">
    <input id="manualCode" placeholder="Serial (manual mode)" style="width:220px">
    <input id="photoInput" accept="image/*" type="file" capture="environment">
    <button id="addManual">Add manual</button>
  </div>

  <div id="list"></div>

  <div id="debug">
    <div><strong>Debug</strong></div>
    <div id="dbg-status">status: idle</div>
    <div id="dbg-cameras">cameras: -</div>
    <div id="dbg-msg"></div>
    <pre id="dbg-console" style="max-height:120px;overflow:auto;background:#fff;padding:6px;border:1px solid #eee"></pre>
  </div>

<script>
/* ========== CONFIG ========== */
// leave empty if no server integration
const APPS_SCRIPT_URL = ""; 

// helpers
function logDbg(s, camerasText, msg) {
  document.getElementById('dbg-status').textContent = 'status: ' + s;
  document.getElementById('dbg-cameras').textContent = 'cameras: ' + (camerasText || '-');
  document.getElementById('dbg-msg').textContent = msg || '';
  const consoleEl = document.getElementById('dbg-console');
  consoleEl.textContent = (new Date().toLocaleTimeString()) + " | " + s + (msg ? " — " + msg : "") + "\n" + consoleEl.textContent;
  console.
